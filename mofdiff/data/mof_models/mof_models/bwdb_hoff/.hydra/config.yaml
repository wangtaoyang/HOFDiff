data:
  name: bwdb
  root_path: ${oc.env:DATASET_DIR}
  prop_list:
  - working_capacity_vacuum_swing [mmol/g]
  - working_capacity_temperature_swing [mmol/g]
  logmod: true
  num_targets: 2
  use_type_mapper: false
  bb_encoder_path: /data/user2/wty/HOF/MOFDiff/mofdiff/data/mof_models/bb/bwdb_bb
  lattice_scale_method: scale_length
  max_bbs: 25
  max_atoms: 200
  max_cps: 200
  otf_graph: false
  train_max_steps: 2000000
  early_stopping_patience: 1000
  teacher_forcing_max_epoch: 300
  patience: 50
  data_cache_path: ${oc.env:DATASET_DIR}
  load_cached: true
  save_cached: false
  datamodule:
    _target_: mofdiff.data.datamodule.DataModule
    bb_encoder_path: ${data.bb_encoder_path}
    datasets:
      train:
        _target_: mofdiff.data.dataset.MOFDataset
        name: ${data.name}_train
        path: ${data.root_path}
        prop_list: ${data.prop_list}
        transforms: ${data.data_transforms}
        max_bbs: ${data.max_bbs}
        max_atoms: ${data.max_atoms}
        max_cps: ${data.max_cps}
        logmod: ${data.logmod}
        split_file: ${oc.env:PROJECT_ROOT}/splits/train_split.txt
      val:
        _target_: mofdiff.data.dataset.MOFDataset
        name: ${data.name}_val
        path: ${data.root_path}
        prop_list: ${data.prop_list}
        transforms: ${data.data_transforms}
        max_bbs: ${data.max_bbs}
        max_atoms: ${data.max_atoms}
        max_cps: ${data.max_cps}
        logmod: ${data.logmod}
        split_file: ${oc.env:PROJECT_ROOT}/splits/val_split.txt
    num_workers:
      train: 0
      val: 0
      test: 0
    batch_size:
      train: 1024
      val: 1024
      test: 1024
  data_transforms: None
logging:
  val_check_interval: 3
  progress_bar_refresh_rate: 10
  tensorboard:
    save_dir: ${oc.env:LOG_DIR}/tensorboard
  lr_monitor:
    logging_interval: step
    log_momentum: false
model:
  encoder:
    readout:
      _target_: mofdiff.model.readout.CombinedGraphReadout
      node_dim: ${model.encoder.num_targets}
      out_dim: ${model.encoder.num_targets}
      num_heads: 8
      head_dim: 32
    _target_: mofdiff.model.gnn.GemNetOCEncoder
    otf_graph: ${model.otf_graph}
    num_blocks: 3
    radius: ${model.radius}
    max_neighbors: ${model.max_neighbors}
    hidden_dim: ${model.hidden_dim}
    num_targets: ${model.latent_dim}
    scale_file: ${oc.env:PROJECT_ROOT}/mofdiff/model/gemnet_oc/gemnet-oc.pt
  decoder:
    _target_: mofdiff.model.gnn.GemNetOCDecoder
    num_blocks: 3
    hidden_dim: ${model.hidden_dim}
    latent_dim: ${model.latent_dim}
    max_neighbors: ${model.max_neighbors}
    radius: ${model.radius}
    scale_file: ${oc.env:PROJECT_ROOT}/mofdiff/model/gemnet_oc/gemnet-oc.pt
  _target_: mofdiff.model.cg_diffusion.MOFDiff
  hidden_dim: 512
  latent_dim: 512
  fc_num_layers: 1
  max_bbs: ${data.max_bbs}
  max_atoms: ${data.max_atoms}
  max_cps: ${data.max_cps}
  cost_natom: 1.0
  cost_coord: 1.0
  cost_type: 1.0
  cost_lattice: 1.0
  cost_property: 1.0
  beta: 0.01
  teacher_forcing_lattice: true
  teacher_forcing_max_epoch: ${data.teacher_forcing_max_epoch}
  otf_graph: false
  max_neighbors: 24
  radius: 4.0
  predict_property: true
  property_dim: ${data.num_targets}
  diffusion_step: 2000
  norm_x: 10.0
  norm_h: 10.0
  diffusion:
    pos:
      sigma_min: 0.001
      sigma_max: 10.0
    type:
      power: 2.0
      clipmax: 0.999
  t_emb_dim: 256
  fourier_scale: 16
optim:
  optimizer:
    _target_: torch.optim.Adam
    lr: 0.0003
    betas:
    - 0.9
    - 0.999
    eps: 1.0e-08
    weight_decay: 0
  use_lr_scheduler: true
  lr_scheduler:
    _target_: torch.optim.lr_scheduler.ReduceLROnPlateau
    factor: 0.6
    patience: ${data.patience}
train:
  deterministic: false
  random_seed: 42
  pl_trainer:
    fast_dev_run: false
    gpus: 6
    precision: 32
    max_steps: ${data.train_max_steps}
    accumulate_grad_batches: 1
    num_sanity_val_steps: 1
    gradient_clip_val: 0.5
    gradient_clip_algorithm: value
    profiler: simple
    limit_val_batches: 50.0
  monitor_metric: val_loss
  monitor_metric_mode: min
  early_stopping:
    patience: ${data.early_stopping_patience}
    verbose: false
  model_checkpoints:
    save_top_k: 2
    every_n_epochs: 2
    save_last: true
    verbose: false
expname: bwdb_hoff
workdir: ${oc.env:HYDRA_JOBS}/mof_models/${expname}
config_for: mof
core:
  version: 0.0.1
  tags:
  - ${now:%Y-%m-%d}
